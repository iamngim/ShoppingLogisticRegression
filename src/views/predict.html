{% extends "layout.html" %}
{% block content %}

<h3 class="fw-bold mb-1 text-primary">
    <i class="bi bi-lightning-charge"></i>
    DỰ ĐOÁN KHÁCH HÀNG MỚI
</h3>
<p class="text-muted fst-italic mb-4">(Customer Purchase Prediction)</p>

<div class="card shadow-sm p-4 border-0">
    {% if error %}
        <div class="alert alert-warning">{{ error }}</div>
    {% endif %}

    {% if prob is not none %}
        <div class="alert alert-info mt-2 animate__animated animate__fadeIn">
            Xác suất khách hàng sẽ <b>mua hàng trong quý tiếp theo</b> là:
            <span class="fw-bold text-primary">{{ "%.2f"|format(prob*100) }}%</span>
        </div>
    {% endif %}

    <form method="POST" class="mt-3">
        <div class="row">
            {% for f in features %}
            <div class="col-md-4 mb-3">
                <label class="form-label fw-semibold">{{ f }}</label>

                {% if f == "Quarter" %}
                    <select name="{{ f }}" class="form-select" required>
                        <option value="">-- Chọn quý --</option>
                        {% for q in range(1, 5) %}
                            {% set selected = 'selected' if input_data.get(f)|int == q else '' %}
                            <option value="{{ q }}" {{ selected }}>Quý {{ q }}</option>
                        {% endfor %}
                    </select>
                {% else %}
                    {% set placeholder_map = {
                        "Recency": "Số ngày kể từ lần mua gần nhất",
                        "Frequency": "Tổng số lần mua trong giai đoạn",
                        "Monetary": "Tổng giá trị chi tiêu (VNĐ)",
                        "AvgOrderValue": "Giá trị trung bình mỗi đơn hàng",
                        "TotalQuarters": "Số quý đã phát sinh giao dịch",
                        "CustomerLifeSpan": "Số ngày hoạt động của khách hàng",
                        "PurchaseTrend3Q": "Xu hướng mua 3 quý gần nhất",
                        "QuarterAmount": "Tổng chi tiêu trong quý hiện tại",
                        "QuarterFrequency": "Số lần mua trong quý hiện tại",
                        "QuarterAvgValue": "Giá trị TB đơn hàng quý hiện tại",
                        "MonetaryPerQuarter": "Chi tiêu trung bình mỗi quý",
                        "Year": "Năm giao dịch (VD: 2024)"
                    } %}
                    <input type="number" step="any" name="{{ f }}" class="form-control"
                           placeholder="{{ placeholder_map.get(f, 'Nhập giá trị...') }}"
                           value="{{ input_data[f]|default('') }}" required>
                {% endif %}
            </div>
            {% endfor %}
        </div>

        <div class="text-end">
            <button class="btn btn-success px-4">
                <i class="bi bi-lightning-charge"></i> Dự đoán
            </button>
        </div>
    </form>
</div>

<style>
    ::placeholder {
        font-style: italic;
        font-size: 0.85rem;
        color: #9aa0a6 !important;
        opacity: 0.9;
    }
</style>

{% endblock %}
